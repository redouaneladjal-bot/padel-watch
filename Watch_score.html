<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>Padel Watch</title>

<style>
  :root{
    --a:#00f2ff;
    --b:#ff4fd8;

    --bg1:#1a1f3c;
    --bg2:#02020a;

    /* auto set by JS */
    --pad-top:10px;
    --pad-right:10px;
    --pad-bottom:10px;
    --pad-left:10px;
  }

  *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;}
  html,body{height:100%;margin:0;color:#fff;background:radial-gradient(circle at top,var(--bg1),var(--bg2));}
  body{display:flex;align-items:center;justify-content:center;overflow:hidden;}

  .app{
    width:100%;
    height:100%;
    padding: var(--pad-top) var(--pad-right) var(--pad-bottom) var(--pad-left);
    display:grid;
    grid-template-rows:auto 1fr auto;
    gap:8px;
  }

  /* TOP: PTS | S1 | S2 | S3  (2 rows: A/B) */
  .top{
    background:rgba(0,0,0,.46);
    border:1px solid rgba(255,255,255,.16);
    border-radius:18px;
    padding:6px;
    display:grid;
    grid-template-columns: 1.15fr 1fr 1fr 1fr;
    grid-template-rows: repeat(2, 1fr);
    gap:5px;
    box-shadow: 0 10px 30px rgba(0,0,0,.55);
    backdrop-filter: blur(6px);
  }

  .cell{
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:900;
    font-size:13px;
    background:rgba(255,255,255,.08);
    border:1px solid rgba(255,255,255,.08);
    border-radius:14px;
    min-height: 24px;
    letter-spacing:.2px;
    overflow:hidden;
  }

  .ptsCell{
    justify-content:space-between;
    padding:0 10px;
  }
  .badge{
    width:18px;height:18px;border-radius:999px;
    display:grid;place-items:center;
    font-size:12px;font-weight:1000;
    border:1px solid rgba(255,255,255,.25);
    background:rgba(0,0,0,.25);
  }
  .badge.a{ box-shadow:0 0 14px rgba(0,242,255,.45); color:var(--a); }
  .badge.b{ box-shadow:0 0 14px rgba(255,79,216,.45); color:var(--b); }

  .ptsText{ font-size:14px; font-weight:1000; }
  .rowA{ background: linear-gradient(90deg, rgba(0,242,255,.14), rgba(255,255,255,.06)); }
  .rowB{ background: linear-gradient(270deg, rgba(255,79,216,.14), rgba(255,255,255,.06)); }

  /* MAIN */
  .main{
    position:relative;
    background:radial-gradient(circle,#0b0f2b,#000);
    border:1px solid rgba(255,255,255,.16);
    box-shadow: 0 18px 60px rgba(0,0,0,.65);
    overflow:hidden;
    display:grid;
    grid-template-columns:1fr 1fr;
  }
  .shape-round .main{ border-radius:50%; }
  .shape-square .main{ border-radius:22px; }

  .zone{
    display:flex;
    justify-content:center;
    align-items:center;
    user-select:none;
    touch-action: manipulation;
    font-weight:1100;
    letter-spacing:1px;
    text-shadow:0 14px 40px rgba(0,0,0,.65);
  }
  .shape-round .zone{ font-size: 20px; }
  .shape-square .zone{ font-size: 26px; }

  .zoneA{ background:radial-gradient(circle at left, rgba(0,242,255,.70), transparent 72%); }
  .zoneB{ background:radial-gradient(circle at right, rgba(255,79,216,.70), transparent 72%); }

  .centerLine{
    position:absolute; top:0; bottom:0; left:50%;
    width:2px;
    background:rgba(255,255,255,.18);
    pointer-events:none;
  }

  /* Serve ball */
  .ball{
    position:absolute;
    top:10px;
    width:18px; height:18px;
    border-radius:50%;
    background:radial-gradient(circle,#fff,#ffcc55);
    box-shadow:0 0 10px rgba(255,204,85,.8);
    display:none;
    touch-action: manipulation;
  }
  .ball.show{display:block;}
  .ball.left{left:10px;}
  .ball.right{right:10px;}

  /* Bottom controls */
  .bottom{
    display:grid;
    grid-template-columns:1fr 1fr 1fr;
    gap:8px;
  }
  .btn{
    height:44px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.16);
    background: linear-gradient(145deg, rgba(255,255,255,.10), rgba(0,0,0,.35));
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:18px;
    box-shadow:0 10px 24px rgba(0,0,0,.55);
    user-select:none;
    touch-action: manipulation;
  }
  .btn:active{ transform: scale(.96); }
  .lockOn{ background: linear-gradient(145deg, rgba(255,80,80,.20), rgba(0,0,0,.35)); border-color: rgba(255,80,80,.35); }

  .hint{
    position:absolute;
    left:50%;
    transform:translateX(-50%);
    bottom:64px;
    background:rgba(0,0,0,.72);
    border:1px solid rgba(255,255,255,.14);
    padding:5px 10px;
    border-radius:999px;
    font-size:12px;
    font-weight:900;
    opacity:0;
    transition: opacity .12s;
    pointer-events:none;
  }
  .hint.show{opacity:1;}

  /* round tweaks */
  .shape-round .top{ padding:5px; }
  .shape-round .cell{ font-size:12px; min-height:22px; border-radius:13px; }
  .shape-round .btn{ height:42px; }

</style>
</head>

<body>
<div class="app" id="app">

  <!-- TOP: PTS | S1 | S2 | S3 -->
  <div class="top">
    <div class="cell ptsCell rowA">
      <span class="badge a">A</span>
      <span class="ptsText" id="ap">0</span>
    </div>
    <div class="cell rowA" id="a1">0</div>
    <div class="cell rowA" id="a2">0</div>
    <div class="cell rowA" id="a3">0</div>

    <div class="cell ptsCell rowB">
      <span class="badge b">B</span>
      <span class="ptsText" id="bp">0</span>
    </div>
    <div class="cell rowB" id="b1">0</div>
    <div class="cell rowB" id="b2">0</div>
    <div class="cell rowB" id="b3">0</div>
  </div>

  <!-- MAIN -->
  <div class="main">
    <div class="zone zoneA" id="za">TEAM A</div>
    <div class="zone zoneB" id="zb">TEAM B</div>
    <div class="centerLine"></div>

    <div class="ball" id="ballA" title="Serve"></div>
    <div class="ball" id="ballB" title="Serve"></div>

    <div class="hint" id="hint">ðŸ”’</div>
  </div>

  <!-- BOTTOM -->
  <div class="bottom">
    <div class="btn" id="lock">ðŸ”’</div>
    <div class="btn" id="undo">â†¶</div>
    <div class="btn" id="reset">âŸ²</div>
  </div>

</div>

<script>
(() => {
  const app = document.getElementById("app");

  // --------- Round vs Square detection + safe padding ----------
  function detectShape(){
    const w = Math.min(window.innerWidth, window.innerHeight);
    const ar = window.innerWidth / window.innerHeight;
    const nearSquare = Math.abs(ar - 1) < 0.09;
    const small = w <= 520;
    const isRound = nearSquare && small;

    app.classList.toggle("shape-round", isRound);
    app.classList.toggle("shape-square", !isRound);

    // Strong safe padding for round
    if (isRound){
      // tuned for Galaxy Watch round faces
      app.style.setProperty("--pad-top", "20%");
      app.style.setProperty("--pad-right", "12%");
      app.style.setProperty("--pad-bottom", "16%");
      app.style.setProperty("--pad-left", "12%");
    } else {
      app.style.setProperty("--pad-top", "10px");
      app.style.setProperty("--pad-right", "10px");
      app.style.setProperty("--pad-bottom", "10px");
      app.style.setProperty("--pad-left", "10px");
    }
  }
  detectShape();
  window.addEventListener("resize", detectShape);

  // --------- UI refs ----------
  const ui = {
    a: [document.getElementById("a1"), document.getElementById("a2"), document.getElementById("a3")],
    b: [document.getElementById("b1"), document.getElementById("b2"), document.getElementById("b3")],
    ap: document.getElementById("ap"),
    bp: document.getElementById("bp"),
    za: document.getElementById("za"),
    zb: document.getElementById("zb"),
    ballA: document.getElementById("ballA"),
    ballB: document.getElementById("ballB"),
    lock: document.getElementById("lock"),
    undo: document.getElementById("undo"),
    reset: document.getElementById("reset"),
    hint: document.getElementById("hint"),
  };

  function showHint(t){
    ui.hint.textContent = t;
    ui.hint.classList.add("show");
    clearTimeout(showHint._t);
    showHint._t = setTimeout(()=>ui.hint.classList.remove("show"), 520);
  }

  // --------- Scoring rules ----------
  // Best of 3: first to 2 sets. No-Ad. TB at 6â€“6.
  const rules = { setsToWin:2, maxSets:3, noAd:true, tbAt66:true };

  const st = {
    locked:false,
    finished:false,

    pts:[0,0], // raw points: 0.. (we display 0/15/30/40)
    games: Array.from({length: rules.maxSets}, () => [0,0]),
    set:0,

    tb:false,
    tbp:[0,0],
    tbTotal:0,

    won:[0,0],

    serve:0, // 0=A, 1=B
    side:0,  // 0=left, 1=right

    hist:[]
  };

  // âœ… SAFE snapshot (excludes hist)
  function makeSnap(){
    return {
      locked: st.locked,
      finished: st.finished,
      pts: [st.pts[0], st.pts[1]],
      games: st.games.map(x => [x[0], x[1]]),
      set: st.set,
      tb: st.tb,
      tbp: [st.tbp[0], st.tbp[1]],
      tbTotal: st.tbTotal,
      won: [st.won[0], st.won[1]],
      serve: st.serve,
      side: st.side
    };
  }
  function applySnap(s){
    st.locked = s.locked;
    st.finished = s.finished;
    st.pts = [s.pts[0], s.pts[1]];
    st.games = s.games.map(x => [x[0], x[1]]);
    st.set = s.set;
    st.tb = s.tb;
    st.tbp = [s.tbp[0], s.tbp[1]];
    st.tbTotal = s.tbTotal;
    st.won = [s.won[0], s.won[1]];
    st.serve = s.serve;
    st.side = s.side;
  }
  function snap(){
    st.hist.push(makeSnap());
    if (st.hist.length > 80) st.hist.shift();
  }

  function scoreLabel(p){
    return ["0","15","30","40"][Math.min(p,3)];
  }
  function g(){ return st.games[st.set]; }

  function rotateServeAfterGame(){
    st.serve ^= 1;
    st.side ^= 1;
  }

  function maybeStartTB(){
    const gg = g();
    if (rules.tbAt66 && gg[0] === 6 && gg[1] === 6){
      st.tb = true;
      st.tbp = [0,0];
      st.tbTotal = 0;
    }
  }

  function endSet(w){
    st.won[w]++;

    st.pts = [0,0];
    st.tb = false;
    st.tbp = [0,0];
    st.tbTotal = 0;

    if (st.won[0] >= rules.setsToWin || st.won[1] >= rules.setsToWin){
      st.finished = true;
      return;
    }

    if (st.set < rules.maxSets - 1) st.set++;
    else st.finished = true;
  }

  function checkSetWinNormal(){
    const gg = g();
    const a = gg[0], b = gg[1];
    const mx = Math.max(a,b);
    const lead = Math.abs(a-b);

    if ((mx === 6 && lead >= 2) || (mx === 7 && lead >= 2)){
      endSet(a > b ? 0 : 1);
      return true;
    }
    return false;
  }

  function winGame(w){
    g()[w]++;

    rotateServeAfterGame();
    maybeStartTB();

    if (!st.tb) checkSetWinNormal();
    st.pts = [0,0];
  }

  // TB serve: 1 point then 2 points; side flips each point
  function tbRotateAfterPoint(){
    st.tbTotal++;
    if (st.tbTotal === 1 || (st.tbTotal > 1 && (st.tbTotal % 2 === 1))){
      st.serve ^= 1;
    }
    st.side ^= 1;
  }

  function tbPoint(w){
    st.tbp[w]++;
    tbRotateAfterPoint();

    const a = st.tbp[0], b = st.tbp[1];
    const mx = Math.max(a,b);
    const lead = Math.abs(a-b);

    if (mx >= 7 && lead >= 2){
      // display set as 7-6
      g()[w] = 7;
      g()[1-w] = 6;
      endSet(w);
    }
  }

  function point(team){
    if (st.locked){ showHint("ðŸ”’"); return; }
    if (st.finished){ showHint("âœ“"); return; }

    snap();

    if (st.tb){
      tbPoint(team);
      render();
      return;
    }

    st.pts[team]++;

    if (rules.noAd){
      // next point after 40-40 wins game
      if (st.pts[0] >= 4 || st.pts[1] >= 4){
        winGame(st.pts[0] > st.pts[1] ? 0 : 1);
      }
    } else {
      const a = st.pts[0], b = st.pts[1];
      if (Math.max(a,b) >= 4 && Math.abs(a-b) >= 2){
        winGame(a > b ? 0 : 1);
      }
    }

    render();
  }

  function renderServe(){
    ui.ballA.className = "ball";
    ui.ballB.className = "ball";

    const el = st.serve ? ui.ballB : ui.ballA;
    el.classList.add("show");
    el.classList.add(st.side ? "right" : "left");
  }

  function render(){
    for (let i=0;i<rules.maxSets;i++){
      ui.a[i].textContent = st.games[i][0];
      ui.b[i].textContent = st.games[i][1];
    }

    // points in first column
    if (st.tb){
      ui.ap.textContent = "TB " + st.tbp[0];
      ui.bp.textContent = "TB " + st.tbp[1];
    } else {
      ui.ap.textContent = scoreLabel(st.pts[0]);
      ui.bp.textContent = scoreLabel(st.pts[1]);
    }

    ui.lock.textContent = st.locked ? "ðŸ”’" : "ðŸ”“";
    ui.lock.classList.toggle("lockOn", st.locked);

    renderServe();
  }

  // --------- Controls ----------
  ui.za.addEventListener("click", ()=>point(0));
  ui.zb.addEventListener("click", ()=>point(1));

  ui.lock.addEventListener("click", ()=>{
    snap();
    st.locked = !st.locked;
    showHint(st.locked ? "ðŸ”’" : "ðŸ”“");
    render();
  });

  ui.undo.addEventListener("click", ()=>{
    if (st.locked){ showHint("ðŸ”’"); return; }
    const s = st.hist.pop();
    if (!s){ showHint("â€”"); return; }
    applySnap(s);
    render();
    showHint("â†¶");
  });

  ui.reset.addEventListener("click", ()=>{
    if (st.locked){ showHint("ðŸ”’"); return; }
    snap();
    st.locked=false;
    st.finished=false;
    st.pts=[0,0];
    st.games=Array.from({length: rules.maxSets}, () => [0,0]);
    st.set=0;
    st.tb=false;
    st.tbp=[0,0];
    st.tbTotal=0;
    st.won=[0,0];
    st.serve=0;
    st.side=0;
    render();
    showHint("âŸ²");
  });

  // manual serve adjust: tap the ball
  function cycleServeManual(){
    if (st.locked){ showHint("ðŸ”’"); return; }
    snap();
    st.side ^= 1;
    if (st.side === 0) st.serve ^= 1;
    render();
    showHint("ðŸŽ¾");
  }
  ui.ballA.addEventListener("click",(e)=>{ e.preventDefault(); cycleServeManual(); });
  ui.ballB.addEventListener("click",(e)=>{ e.preventDefault(); cycleServeManual(); });

  render();
})();
</script>
</body>
</html>
