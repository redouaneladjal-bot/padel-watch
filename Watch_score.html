<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>Padel Watch</title>
  <style>
    :root{
      --bg:#050509;
      --line:rgba(255,255,255,.10);
      --txt:rgba(255,255,255,.92);
      --shadow: 0 18px 60px rgba(0,0,0,.65);

      /* âœ… Galaxy Watch 44mm: safe margin for round screen */
      --round-safe: 12px;
    }
    *{ box-sizing:border-box; font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; }
    html,body{ height:100%; margin:0; background: radial-gradient(120% 100% at 50% 0%, #0b0b18 0%, var(--bg) 55%, #000 100%); color:var(--txt); }
    body{ display:flex; align-items:center; justify-content:center; overflow:hidden; }

    /* âœ… Round-screen friendly safe padding */
    .wrap{
      width:100%;
      height:100%;
      padding:
        calc(8px + env(safe-area-inset-top) + var(--round-safe))
        calc(8px + env(safe-area-inset-right) + var(--round-safe))
        calc(8px + env(safe-area-inset-bottom) + var(--round-safe))
        calc(8px + env(safe-area-inset-left) + var(--round-safe));
      display:grid;
      grid-template-rows: auto 1fr auto;
      gap:10px;
    }

    /* TOP: TEAM | S1 | S2 | S3 | PTS */
    .mini{
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border-radius:16px;
      box-shadow: var(--shadow);
      padding:8px;
      display:grid;
      grid-template-columns: 1.25fr .9fr .9fr .9fr .95fr;
      grid-template-rows: repeat(2, 1fr);
      gap:6px;
    }
    .cell{
      border:1px solid rgba(255,255,255,.10);
      border-radius:12px;
      background: rgba(0,0,0,.25);
      display:grid;
      place-items:center;
      font-weight:1050;
      font-size: 15px;
      letter-spacing:.2px;
      color: rgba(255,255,255,.86);
      min-height: 26px;
      overflow:hidden;
    }
    .dim{ color: rgba(255,255,255,.30); }

    .teamCell{
      display:flex;
      align-items:center;
      justify-content:flex-start;
      gap:8px;
      padding:0 10px;
      font-weight:1150;
      letter-spacing:.3px;
      font-size:13px;
      color: rgba(255,255,255,.85);
    }
    .badge{
      width:16px; height:16px; border-radius:999px;
      border:1px solid rgba(255,255,255,.25);
      flex:0 0 auto;
      box-shadow: 0 10px 22px rgba(0,0,0,.45);
    }
    .badge.a{ background: radial-gradient(circle at 35% 35%, rgba(255,255,255,.95), rgba(0,240,255,.85) 55%, rgba(29,124,255,.75)); }
    .badge.b{ background: radial-gradient(circle at 35% 35%, rgba(255,255,255,.95), rgba(181,107,255,.85) 55%, rgba(255,77,184,.75)); }

    /* MID */
    .stage{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      border-radius:22px;
      box-shadow: var(--shadow);
      overflow:hidden;
      display:grid;
      grid-template-columns: 1fr 1fr;
      position:relative;
    }
    .divider{
      position:absolute; top:0; bottom:0; left:50%;
      width:1px;
      background: rgba(255,255,255,.10);
      pointer-events:none;
    }

    .zone{
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
      user-select:none;
      touch-action: manipulation;
    }
    .zone::before{
      content:"";
      position:absolute; inset:-50px;
      background: radial-gradient(80% 70% at 50% 35%, rgba(255,255,255,.08), transparent 55%);
      pointer-events:none;
    }
    .zoneA{ background: linear-gradient(135deg, rgba(0,240,255,.16), rgba(29,124,255,.08)); }
    .zoneB{ background: linear-gradient(225deg, rgba(181,107,255,.16), rgba(255,77,184,.08)); }

    /* âœ… Smaller center labels */
    .label{
      font-weight:1200;
      font-size: clamp(16px, 5.6vw, 24px);
      letter-spacing:1.1px;
      opacity:.92;
      text-shadow: 0 14px 50px rgba(0,0,0,.65);
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(6px);
    }

    /* Serve ball */
    .serve{
      position:absolute;
      top:8px;
      width:20px; height:20px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.35);
      background:
        radial-gradient(circle at 35% 35%, rgba(255,255,255,.95), rgba(255,255,255,.45) 45%, rgba(0,0,0,.20) 70%),
        radial-gradient(circle at 70% 70%, rgba(255,210,80,.95), rgba(255,210,80,.15) 60%, transparent 70%);
      box-shadow: 0 10px 26px rgba(0,0,0,.55);
      display:none;
      user-select:none;
      touch-action: manipulation;
      opacity:.95;
    }
    .serve.show{ display:block; }
    .serve.left{ left:8px; }
    .serve.right{ right:8px; }

    /* Bottom buttons */
    .bottom{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:10px;
      align-items:center;
    }
    .btn{
      position:relative;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      border-radius:18px;
      padding:10px 8px;
      display:flex;
      align-items:center;
      justify-content:center;
      user-select:none;
      touch-action: manipulation;
      box-shadow: 0 10px 28px rgba(0,0,0,.55);
      overflow:hidden;
    }
    .btn:active{ transform: translateY(1px); }
    .ico{ font-size:18px; line-height:1; opacity:.92; filter: drop-shadow(0 8px 20px rgba(0,0,0,.55)); }
    .lockOn{ border-color: rgba(255,77,77,.35); background: rgba(255,77,77,.10); }

    .holdBar{
      position:absolute; inset:0;
      width:0%;
      background: rgba(54,255,139,.12);
      border-right: 2px solid rgba(54,255,139,.45);
      pointer-events:none;
      transition: width 0s;
    }
    .holdDanger{
      background: rgba(255,77,77,.10);
      border-right: 2px solid rgba(255,77,77,.45);
    }

    .hint{
      position:absolute;
      left:50%; transform: translateX(-50%);
      bottom: 58px;
      font-weight:900;
      font-size:12px;
      color: rgba(255,255,255,.55);
      padding:6px 10px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.25);
      border-radius:999px;
      backdrop-filter: blur(6px);
      min-width: 86px;
      text-align:center;
      opacity:0;
      transition: opacity .12s;
      pointer-events:none;
    }
    .hint.show{ opacity:1; }
  </style>
</head>
<body>
  <div class="wrap">

    <div class="mini">
      <div class="cell teamCell"><span class="badge a"></span>TEAM A</div>
      <div class="cell" id="aS1">0</div>
      <div class="cell dim" id="aS2">0</div>
      <div class="cell dim" id="aS3">0</div>
      <div class="cell" id="aPts">0</div>

      <div class="cell teamCell"><span class="badge b"></span>TEAM B</div>
      <div class="cell" id="bS1">0</div>
      <div class="cell dim" id="bS2">0</div>
      <div class="cell dim" id="bS3">0</div>
      <div class="cell" id="bPts">0</div>
    </div>

    <div class="stage">
      <div class="zone zoneA" id="zoneA">
        <div class="serve" id="serveA"></div>
        <div class="label">TEAM A</div>
      </div>
      <div class="divider"></div>
      <div class="zone zoneB" id="zoneB">
        <div class="serve" id="serveB"></div>
        <div class="label">TEAM B</div>
      </div>
      <div class="hint" id="hint">ðŸ”’</div>
    </div>

    <div class="bottom">
      <div class="btn" id="lockBtn"><div class="ico" id="lockIco">ðŸ”’</div></div>
      <div class="btn" id="undoBtn">
        <div class="holdBar" id="undoBar"></div>
        <div class="ico">â†¶</div>
      </div>
      <div class="btn" id="resetBtn">
        <div class="holdBar holdDanger" id="resetBar"></div>
        <div class="ico">âŸ²</div>
      </div>
    </div>

  </div>

<script>
(() => {
  // Best of 3: first to 2 sets wins. No-Ad. TB at 6â€“6.
  const rules = { noAd:true, tieBreakAt66:true, setsToWin:2, maxSets:3 };

  const st = {
    locked:false,
    finished:false,

    points:[0,0],
    setGames: Array.from({length: rules.maxSets}, () => [0,0]),
    currentSet:0,

    tieBreak:false,
    tb:[0,0],
    tbPointsTotal:0,

    setsWon:[0,0],
    serveTeam:0,
    serveSide:0,

    history:[]
  };

  const $ = (id) => document.getElementById(id);
  const ui = {
    aS:[ $("aS1"),$("aS2"),$("aS3") ],
    bS:[ $("bS1"),$("bS2"),$("bS3") ],
    aPts:$("aPts"), bPts:$("bPts"),
    zoneA:$("zoneA"), zoneB:$("zoneB"),
    serveA:$("serveA"), serveB:$("serveB"),
    lockBtn:$("lockBtn"), lockIco:$("lockIco"),
    undoBtn:$("undoBtn"), undoBar:$("undoBar"),
    resetBtn:$("resetBtn"), resetBar:$("resetBar"),
    hint:$("hint"),
  };

  function showHint(txt){
    ui.hint.textContent = txt;
    ui.hint.classList.add("show");
    clearTimeout(showHint._t);
    showHint._t = setTimeout(()=> ui.hint.classList.remove("show"), 520);
  }

  // Snapshot WITHOUT history (prevents freeze)
  function makeSnapshot(){
    return {
      locked: st.locked,
      finished: st.finished,
      points: [st.points[0], st.points[1]],
      setGames: st.setGames.map(s => [s[0], s[1]]),
      currentSet: st.currentSet,
      tieBreak: st.tieBreak,
      tb: [st.tb[0], st.tb[1]],
      tbPointsTotal: st.tbPointsTotal,
      setsWon: [st.setsWon[0], st.setsWon[1]],
      serveTeam: st.serveTeam,
      serveSide: st.serveSide
    };
  }
  function applySnapshot(snap){
    st.locked = snap.locked;
    st.finished = snap.finished;
    st.points = [snap.points[0], snap.points[1]];
    st.setGames = snap.setGames.map(s => [s[0], s[1]]);
    st.currentSet = snap.currentSet;
    st.tieBreak = snap.tieBreak;
    st.tb = [snap.tb[0], snap.tb[1]];
    st.tbPointsTotal = snap.tbPointsTotal;
    st.setsWon = [snap.setsWon[0], snap.setsWon[1]];
    st.serveTeam = snap.serveTeam;
    st.serveSide = snap.serveSide;
  }
  function snapshot(){
    st.history.push(makeSnapshot());
    if (st.history.length > 120) st.history.shift();
  }
  function undo(){
    if (st.locked) return false;
    const prev = st.history.pop();
    if (!prev) return false;
    applySnapshot(prev);
    return true;
  }
  function resetAll(){
    if (st.locked) return false;
    snapshot();
    st.locked=false; st.finished=false;
    st.points=[0,0];
    st.setGames = Array.from({length: rules.maxSets}, () => [0,0]);
    st.currentSet=0;
    st.tieBreak=false; st.tb=[0,0]; st.tbPointsTotal=0;
    st.setsWon=[0,0];
    st.serveTeam=0; st.serveSide=0;
    return true;
  }

  function scoreLabel(p){
    if (p===0) return "0";
    if (p===1) return "15";
    if (p===2) return "30";
    return "40";
  }
  function gamesNow(){ return st.setGames[st.currentSet]; }

  function rotateServeAfterGame(){
    st.serveTeam = 1 - st.serveTeam;
    st.serveSide = 1 - st.serveSide;
  }

  function maybeStartTB(){
    const g = gamesNow();
    if (rules.tieBreakAt66 && g[0]===6 && g[1]===6){
      st.tieBreak = true;
      st.tb=[0,0];
      st.tbPointsTotal=0;
    }
  }

  function endSet(winner){
    st.setsWon[winner]++;

    st.points=[0,0];
    st.tieBreak=false;
    st.tb=[0,0];
    st.tbPointsTotal=0;

    if (st.setsWon[0] >= rules.setsToWin || st.setsWon[1] >= rules.setsToWin){
      st.finished = true;
      return;
    }
    if (st.currentSet < rules.maxSets - 1){
      st.currentSet++;
    } else {
      st.finished = true;
    }
  }

  function checkSetWinNormal(){
    const g = gamesNow();
    const a=g[0], b=g[1];
    const lead=Math.abs(a-b);
    const mx=Math.max(a,b);

    if ((mx===6 && lead>=2) || (mx===7 && lead>=2)){
      endSet(a>b ? 0 : 1);
      return true;
    }
    return false;
  }

  function winGame(team){
    const g = gamesNow();
    g[team]++;

    rotateServeAfterGame();
    maybeStartTB();

    if (!st.tieBreak){
      checkSetWinNormal();
    }
    st.points=[0,0];
  }

  // TB service: 1 then 2; side flips each point
  function tbRotateServeAfterPoint(){
    st.tbPointsTotal++;
    if (st.tbPointsTotal === 1 || (st.tbPointsTotal > 1 && (st.tbPointsTotal % 2 === 1))){
      st.serveTeam = 1 - st.serveTeam;
    }
    st.serveSide = 1 - st.serveSide;
  }

  function tbPoint(team){
    st.tb[team]++;
    tbRotateServeAfterPoint();

    const a=st.tb[0], b=st.tb[1];
    const mx=Math.max(a,b), lead=Math.abs(a-b);
    if (mx>=7 && lead>=2){
      const g = gamesNow();
      g[team]=7; g[1-team]=6;
      endSet(team);
    }
  }

  function point(team){
    if (st.locked){ showHint("ðŸ”’"); return; }
    if (st.finished){ showHint("âœ“"); return; }

    snapshot();

    if (st.tieBreak){
      tbPoint(team);
      render();
      return;
    }

    st.points[team]++;
    const a=st.points[0], b=st.points[1];

    if (rules.noAd){
      if (a>=4 || b>=4) winGame(a>b ? 0 : 1);
    } else {
      const lead=Math.abs(a-b), mx=Math.max(a,b);
      if (mx>=4 && lead>=2) winGame(a>b?0:1);
    }

    render();
  }

  function renderTable(){
    for (let i=0;i<rules.maxSets;i++){
      ui.aS[i].textContent = st.setGames[i][0];
      ui.bS[i].textContent = st.setGames[i][1];
      ui.aS[i].classList.toggle("dim", st.currentSet < i);
      ui.bS[i].classList.toggle("dim", st.currentSet < i);
    }

    if (st.tieBreak){
      ui.aPts.textContent = st.tb[0];
      ui.bPts.textContent = st.tb[1];
    } else {
      ui.aPts.textContent = scoreLabel(Math.min(st.points[0],3));
      ui.bPts.textContent = scoreLabel(Math.min(st.points[1],3));
    }
  }

  function renderServe(){
    ui.serveA.classList.remove("show","left","right");
    ui.serveB.classList.remove("show","left","right");
    const el = (st.serveTeam===0) ? ui.serveA : ui.serveB;
    el.classList.add("show");
    el.classList.add(st.serveSide===0 ? "left" : "right");
  }

  function renderLock(){
    ui.lockBtn.classList.toggle("lockOn", st.locked);
    ui.lockIco.textContent = st.locked ? "ðŸ”’" : "ðŸ”“";
  }

  function render(){
    renderTable();
    renderServe();
    renderLock();
  }

  // Hold-to-confirm Undo/Reset
  function holdToConfirm({buttonEl, barEl, holdMs, onConfirm, okHint}){
    let holdTimer=null, holdStart=0, raf=null;
    function resetUI(){
      barEl.style.width="0%";
      barEl.style.transition="width 0s";
      if (raf) cancelAnimationFrame(raf);
      raf=null;
      if (holdTimer) clearTimeout(holdTimer);
      holdTimer=null;
      holdStart=0;
    }
    function tick(){
      const elapsed = Date.now() - holdStart;
      const pct = Math.max(0, Math.min(100, (elapsed/holdMs)*100));
      barEl.style.width = pct.toFixed(1) + "%";
      if (pct < 100) raf = requestAnimationFrame(tick);
    }
    function start(){
      if (st.locked){ showHint("ðŸ”’"); return; }
      resetUI();
      showHint("â€¦");
      holdStart = Date.now();
      raf = requestAnimationFrame(tick);
      holdTimer = setTimeout(() => {
        onConfirm();
        barEl.style.transition="width .12s";
        barEl.style.width="100%";
        showHint(okHint);
        setTimeout(()=>{ resetUI(); render(); }, 420);
      }, holdMs);
    }
    function cancel(){
      if (!holdStart) return;
      resetUI();
      ui.hint.classList.remove("show");
    }
    buttonEl.addEventListener("pointerdown",(e)=>{ e.preventDefault(); start(); });
    buttonEl.addEventListener("pointerup", cancel);
    buttonEl.addEventListener("pointercancel", cancel);
    buttonEl.addEventListener("pointerleave", cancel);
    buttonEl.addEventListener("click",(e)=>e.preventDefault());
  }

  // Taps
  ui.zoneA.addEventListener("click", ()=> point(0));
  ui.zoneB.addEventListener("click", ()=> point(1));

  // Lock
  ui.lockBtn.addEventListener("click",(e)=>{
    e.preventDefault();
    snapshot();
    st.locked = !st.locked;
    showHint(st.locked ? "ðŸ”’" : "ðŸ”“");
    render();
  });

  // Undo / Reset
  holdToConfirm({
    buttonEl: ui.undoBtn,
    barEl: ui.undoBar,
    holdMs: 700,
    onConfirm: ()=>{ const ok = undo(); showHint(ok ? "â†¶" : "â€”"); },
    okHint:"â†¶"
  });
  holdToConfirm({
    buttonEl: ui.resetBtn,
    barEl: ui.resetBar,
    holdMs: 1200,
    onConfirm: ()=>{ resetAll(); },
    okHint:"âŸ²"
  });

  // Manual serve correction: tap the ball
  function cycleServeManual(){
    if (st.locked){ showHint("ðŸ”’"); return; }
    snapshot();
    st.serveSide = 1 - st.serveSide;
    if (st.serveSide === 0) st.serveTeam = 1 - st.serveTeam;
    render();
  }
  ui.serveA.addEventListener("click",(e)=>{ e.preventDefault(); cycleServeManual(); });
  ui.serveB.addEventListener("click",(e)=>{ e.preventDefault(); cycleServeManual(); });

  render();
})();
</script>
</body>
</html>
